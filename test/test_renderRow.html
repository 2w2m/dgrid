<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Test renderRow functionality</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
		<meta name="viewport" content="width=570" />
		<style type="text/css">
			@import "../../dojo/resources/dojo.css";
			@import "../css/skins/claro.css";
			body {
				padding: 0 80px; /* side padding to make it easier to scroll doc */
			}
		</style>
		<script type="text/javascript" src="../../dojo/dojo.js" 
			data-dojo-config="async: true"></script>
		<script type="text/javascript">
			var data = [
				{order: 1, name:"preheat", description:"Preheat your oven to 350F"},
				{order: 2, name:"mix dry", description:"In a medium bowl, combine flour, salt, and baking soda"},
				{order: 3, name:"mix butter", description:"In a large bowl, beat butter, then add the brown sugar and white sugar then mix"},
				{order: 4, name:"mix together", description:"Slowly add the dry ingredients from the medium bowl to the wet ingredients in the large bowl, mixing until the dry ingredients are totally combined"},
				{order: 5, name:"chocolate chips", description:"Add chocolate chips"},
				{order: 6, name:"make balls", description:"Scoop up a golf ball size amount of dough with a spoon and drop in onto a cookie sheet"},
				{order: 7, name:"bake", description:"Put the cookies in the oven and bake for about 10-14 minutes"},
				{order: 8, name:"remove", description:"Using a spatula, lift cookies off onto wax paper or a cooling rack"},
				{order: 9, name:"eat", description:"Eat and enjoy!"}
			];
			
			var store; // defined later, Memory store containing data
			
			function getOrdinal(num){
				// returns a String consisting of num + the appropriate ordinal suffix
				var ord = 'th';
				switch (num % 10) {
					case 1:
						ord = 'st';
						break;
					case 2:
						ord = 'nd';
						break;
					case 3:
						ord = 'rd';
						break;
				}
				return num + ord;
			}
			
			function testFormatter(item){
				return "<h3>Step " + item.order + ": " + item.name + "</h3><p>" +
					item.description + "</p>";
			}
			
			function testGet(inRowIndex, inItem){
				return getOrdinal(inItem.order);
			}
			
			function testRenderCell(object, data, td, options){
				return getOrdinal(object.order);
			}
			
			var columnsLegacyFormatter = {
				order: {
					name: "Step",
					sortable: false,
					field: "_item",
					formatter: testFormatter
				}
			};
			var columnsLegacyGet = {
				order: {
					name: "Step",
					get: testGet
				},
				name: {},
				description: {name: "what to do", sortable: false}
			};
			var columnsNew = {
				order: {
					name: "Step",
					renderCell: testRenderCell
				},
				name: {},
				description: {name: "what to do", sortable: false}
			};
			require(["dgrid/Grid", "dgrid/OnDemandGrid", "dgrid/GridFromHtml", "dojo/store/Memory", "dojo/store/Observable", "dojo/_base/declare", "dojo/parser", "dojo/domReady!"],
			function(Grid, OnDemandGrid, GridFromHtml, Memory, Observable, declare, parser){
				
				// fully-programmatic tests
				
				window.gridLegacyFormatter = new Grid({
					columns: columnsLegacyFormatter
				}, "gridLegacyFormatter");
				gridLegacyFormatter.renderArray(data);
				
				window.gridLegacyGet = new Grid({
					columns: columnsLegacyGet
				}, "gridLegacyGet");
				gridLegacyGet.renderArray(data);
				
				window.gridNew = new Grid({
					columns: columnsNew
				}, "gridNew");
				gridNew.renderArray(data);
				
				// GridFromHtml tests
				
				window.gridFromHtmlLegacyFormatter = new GridFromHtml({},
					"gridFromHtmlLegacyFormatter");
				gridFromHtmlLegacyFormatter.renderArray(data);
				
				window.gridFromHtmlLegacyGet = new GridFromHtml({},
					"gridFromHtmlLegacyGet");
				gridFromHtmlLegacyGet.renderArray(data);
				
				window.gridFromHtmlNew = new GridFromHtml({},
					"gridFromHtmlNew");
				gridFromHtmlNew.renderArray(data);
				
				window.gridFromHtmlTestProps = new GridFromHtml({},
					"gridFromHtmlTestProps");
				gridFromHtmlTestProps.renderArray(data);
				
				// need to expose GridFromHtml as a global for parser to find.
				// (need a version with OnDemandGrid for store usage)
				window.OnDemandGridFromHtml = declare([OnDemandGrid, GridFromHtml]);
				
				// also, need a store, since there's currently no way to effectively
				// invoke renderArray from HTML.
				store = Observable(Memory({data: data}));
				parser.parse();
			});
			
		</script>
	</head>
	<body class="claro">
		<p>This page tests various responsibilities of renderRow in Grid.js,
			particularly those sensitive to dojox-grid-friendly properties.
			It also tests mappings made in GridFromHtml.js.</p>
		<h2>1a: Grid with single column with formatter for _item field (legacy grid behavior)</h2>
		<div id="gridLegacyFormatter"></div>
		<h2>1b: Grid with single column with get for order field (legacy grid behavior)</h2>
		<div id="gridLegacyGet"></div>
		<h2>1c: Grid with single column with renderCell function (dgrid behavior; should look same as previous)</h2>
		<div id="gridNew"></div>
		
		<hr/>
		
		<!-- GridFromHtml should look for TRs with THs anywhere.
			Testing here with one thead, one tbody, and one implicit. -->
		<h2>2a: Same as 1a, using GridFromHtml</h2>
		<table id="gridFromHtmlLegacyFormatter">
			<thead>
				<tr>
					<th field="_item" sortable="false" formatter="testFormatter">Step</th>
				</tr>
			</thead>
		</table>
		<h2>2b: Same as 1b, using GridFromHtml</h2>
		<table id="gridFromHtmlLegacyGet">
			<tbody>
				<tr>
					<th field="order" get="testGet">Step</th>
					<th>name</th>
					<th field="description" sortable="false">what to do</th>
				</tr>
			</tbody>
		</table>
		<h2>2c: Same as 1c, using GridFromHtml</h2>
		<table id="gridFromHtmlNew">
			<tr>
				<th field="order" renderCell="testRenderCell">Step</th>
				<th>name</th>
				<th field="description" sortable="false">what to do</th>
			</tr>
		</table>
		<hr/>
		<h2>2d: Testing numeric and boolean property (un)specification in GridFromHtml</h2>
		<table id="gridFromHtmlTestProps">
			<thead>
				<tr>
					<th field="name" rowspan="2">No sortable attr (defaults to true)</th>
					<th field="name" colspan="2" sortable>sortable attr present, no value</th>
				</tr>
				<tr>
					<th field="name" sortable="false">sortable="false"</th>
					<th field="name" sortable="true">sortable="true"</th>
				</tr>
			</thead>
		</table>
		
		<hr/>
		
		<h2>3a: Same as 2a, parsed from declarative markup (using a store)</h2>
		<table id="gridDeclarativeLegacyFormatter" data-dojo-id="gridDeclarativeLegacyFormatter"
			data-dojo-type="OnDemandGridFromHtml" data-dojo-props="store: store">
			<thead>
				<tr>
					<th field="_item" sortable="false" formatter="testFormatter">Step</th>
				</tr>
			</thead>
		</table>
		<h2>3b: Same as 2b, parsed from declarative markup (using a store)</h2>
		<table id="gridDeclarativeLegacyGet" data-dojo-id="gridDeclarativeLegacyGet"
			data-dojo-type="OnDemandGridFromHtml" data-dojo-props="store: store">
			<tbody>
				<tr>
					<th field="order" get="testGet">Step</th>
					<th>name</th>
					<th field="description" sortable="false">what to do</th>
				</tr>
			</tbody>
		</table>
		<h2>3c: Same as 2c, parsed from declarative markup (using a store)</h2>
		<table id="gridDeclarativeNew" data-dojo-id="gridDeclarativeNew"
			data-dojo-type="OnDemandGridFromHtml" data-dojo-props="store: store">
			<tr>
				<th field="order" renderCell="testRenderCell">Step</th>
				<th>name</th>
				<th field="description" sortable="false">what to do</th>
			</tr>
		</table>
	</body>
</html>
